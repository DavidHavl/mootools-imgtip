var imgTip=new Class({Implements:[Events,Options],options:{onShow:function(){this.imgtip.setStyle("display","block")},onHide:function(){this.imgtip.setStyle("display","none")},title:"title",body:function(e){var t=e.get("data-imgtip-url")||e.get("rel")||e.get("href");if(t){return'<img src="'+t+'" alt="imgtip full image">'}return e.get("text")},showDelay:100,hideDelay:100,className:"imgtip_container",offset:{x:16,y:16},windowPadding:{x:0,y:0},fixed:false},initialize:function(){var e=Array.link(arguments,{options:Type.isObject,elements:function(e){return e!=null}});this.setOptions(e.options);if(e.elements)this.attach(e.elements);this.container=new Element("div",{"class":"imgtip_content"});if(this.options.id){this.container.set("id",this.options.id)}},toElement:function(){if(this.imgtip)return this.imgtip;this.imgtip=(new Element("div",{"class":this.options.className,styles:{position:"absolute",top:0,left:0}})).adopt(new Element("div",{"class":"imgtip-top"}),this.container,new Element("div",{"class":"imgtip-bottom"}));return this.imgtip},read:function(e,t){return e?typeOf(e)=="function"?e(t):t.get(e):""},attach:function(e){$$(e).each(function(e){var t=this.read(this.options.title,e),n=this.read(this.options.body,e);e.set("title","").store("imgtip:native",t).retrieve("imgtip:title",t);e.retrieve("imgtip:body",n);this.fireEvent("attach",[e]);var r=["enter","leave"];if(!this.options.fixed)r.push("move");r.each(function(t){var n=e.retrieve("imgtip:"+t);if(!n)n=function(n){this["element"+t.capitalize()].apply(this,[n,e])}.bind(this);e.store("imgtip:"+t,n).addEvent("mouse"+t,n)},this)},this);return this},detach:function(e){$$(e).each(function(e){["enter","leave","move"].each(function(t){e.removeEvent("mouse"+t,e.retrieve("imgtip:"+t)).eliminate("imgtip:"+t)});this.fireEvent("detach",[e]);if(this.options.title=="title"){var t=e.retrieve("imgtip:native");if(t)e.set("title",t)}},this);return this},elementEnter:function(e,t){clearTimeout(this.timer);this.timer=function(){this.container.empty();["title","body"].each(function(e){var n=t.retrieve("imgtip:"+e);var r=this["_"+e+"Element"]=(new Element("div",{"class":"imgtip-"+e})).inject(this.container);if(n)this.fill(r,n)},this);this.show(t);this.position(this.options.fixed?{page:t.getPosition()}:e)}.delay(this.options.showDelay,this)},elementLeave:function(e,t){clearTimeout(this.timer);this.timer=this.hide.delay(this.options.hideDelay,this,t);this.fireForParent(e,t)},setTitle:function(e){if(this._titleElement){this._titleElement.empty();this.fill(this._titleElement,e)}return this},setBody:function(e){if(this._bodyElement){this._bodyElement.empty();this.fill(this._bodyElement,e)}return this},fireForParent:function(e,t){t=t.getParent();if(!t||t==document.body)return;if(t.retrieve("imgtip:enter"))t.fireEvent("mouseenter",e);else this.fireForParent(e,t)},elementMove:function(e,t){this.position(e)},position:function(e){if(!this.imgtip)document.id(this);var t=window.getSize(),n=window.getScroll(),r={x:this.imgtip.offsetWidth,y:this.imgtip.offsetHeight},i={x:"left",y:"top"},s={y:false,x2:false,y2:false,x:false},o={};for(var u in i){o[i[u]]=e.page[u]+this.options.offset[u];if(o[i[u]]<0)s[u]=true;if(o[i[u]]+r[u]-n[u]>t[u]-this.options.windowPadding[u]){o[i[u]]=e.page[u]-this.options.offset[u]-r[u];s[u+"2"]=true}}this.fireEvent("bound",s);this.imgtip.setStyles(o)},fill:function(e,t){if(typeof t=="string")e.set("html",t);else e.adopt(t)},show:function(e){if(!this.imgtip)document.id(this);if(!this.imgtip.getParent())this.imgtip.inject(document.body);this.fireEvent("show",[this.imgtip,e])},hide:function(e){if(!this.imgtip)document.id(this);this.fireEvent("hide",[this.imgtip,e])}})